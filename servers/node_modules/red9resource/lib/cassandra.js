var _ = require('underscore')._;
var cassandra;

exports.init = function(config){
    cassandra = new (require('node-cassandra-cql').Client)({
        hosts: config.cassandraHosts,
        keyspace: config.cassandraKeyspace
    });
};

/**
 * There's no configuration check here since that's a programmer error, and should be caught very quickly.
 *
 * There's no configuration check here since that's a programmer error, and should be caught very quickly.
 *
 * rowCallback (mappedResource, currentRow)
 * callback (err, rowCount)
 * @param options
 */
exports.execute = function (options) {
    var query = options.query;
    var rowCallback = options.rowCallback;
    var callback = options.callback;

    var parameters = options.parameters;
    if(!_.isArray(parameters)){
        parameters = [];
    }
//
    //console.log('Query: ' + query);
    //console.dir(parameters);

    cassandra.eachRow(query, parameters,
        function (n, row) {
            if (_.isFunction(rowCallback)) {
                rowCallback(row, n);
            }
        },
        callback);
};
