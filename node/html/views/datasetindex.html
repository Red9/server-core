<link rel="stylesheet" type="text/css" href="/css/jquery.dataTables.css">
<script src="/js/jquery.dataTables.js"></script>

<script src="/js/jquery.jeditable.js"></script>

<script>
    var oTable;
    $(document).ready(function() {
        oTable = $('#dataset_list').dataTable({
            "aaSorting": [[2, "des"]],
            "aLengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
        });


        $('.editable').editable(function(value, settings) {
            console.log(this);
            console.log(value);
            console.log(settings);
            return(value);
        }, {
            type: 'text',
            width: ($('.name_cell').width() - 10) + "px",
            height: ($('.name_cell').height() + 8) + "px"
        });

    });

    var apiDomain = '{{apiUrl}}';

    var deleteDataset = function(id) {
        $.ajax({
            type: 'DELETE',
            url: apiDomain + "/dataset/" + id,
            datatype:'json',
            success: function() {
                var row = $("#dataset_list_row_" + id);
                row.addClass('danger');
                row.hide("slow", function() {
                    oTable.fnDeleteRow(row[0]);
                });

            },
            error: function() {
                alert("Internal Error: could not delete dataset. Please notify a sysadmin.");
            }
        });

    };
</script>



<div class="panel panel-default">
    <div class="panel-heading"><strong>{{page_title}}</strong></div>
    <div class="panel-body"></div>
    <table class="table table-striped table-bordered" id="dataset_list">
        <thead>
            <tr>
                <th>Title</th>
                <th>Owner</th>
                <th>Created</th>
                <th>Duration</th>
                <th></th>
            </tr>
        </thead>
        <tbody>

            {{#each datasets}}   
            <tr id="dataset_list_row_{{{id}}}">
                <td  class="editable name_cell">{{{title}}}</td>
                <td><a href="/user/{{{create_user.id}}}">{{{owner.displayName}}}</a></td>
                <td>{{{epochdate createTime}}}&nbsp;&nbsp;{{{epochtime createTime}}}</td>
                <td>{{{duration startTime endTime}}}</td>

                <td><a class="btn btn-xs btn-primary" href="/dataset/{{{id}}}">View Dataset</a>&nbsp;&nbsp;&nbsp;&nbsp;
                    <a class="btn btn-xs btn-danger" onclick='deleteDataset("{{{id}}}")'>Delete</a>
                </td>
            </tr>
            {{/each}}

        </tbody>
    </table>
</div>

<br /><br /><br /><br />

<h2>Tools</h2>
<div class="panel panel-default">
    <div class="panel-heading"><strong>Administrator tools</strong></div>
    <ul class="list-group">
        <li class="list-group-item"><a href="/monitor">Monitoring</a></li>
        <li class="list-group-item"><a href="/admin/reprocessstatistics">Reprocess Statistics</a></li>
    </ul>
</div>
