<script>
    var event_id = "{{{dataset.event_tree}}}";
    var aggregate_statistics_snippet_url = "/snippet/aggregatestatistics?units=common&id=" + event_id;


    var LoadAggregateStatistics = function() {
        $("#aggregatestatistics").load(aggregate_statistics_snippet_url,
                function(response, status, xhr) {
                    if (xhr.status === 204) {
                        setTimeout(LoadAggregateStatistics, 1000);
                    }
                });
    };

    $(document).ready(function() {
        var eventTree = "{{{dataset.event_tree}}}";

        // Dynamically load snippets.
        var event_tree_url = "/snippet/eventtree?id=" + eventTree;
        $("#insert_event_tree").load(event_tree_url);

        LoadAggregateStatistics();


        $("#delete").click(function() {
            $.ajax(
                    "/api/dataset/{{dataset.id}}",
                    {type: "delete"}
            ).done(function() {
                window.location.replace('/');
            }
            ).fail(function() {
                alert("Internal Error: could not delete dataset. Please notify a sysadmin.");
            });
        });
    });

</script>

<div class="row">
    <div class="col-xs-6">
        <h3>Summary</h3>
    </div>

    <div class="col-xs-6">
        <div id="delete"> <h3><a class="btn btn-xs btn-danger pull-right">Delete Dataset</a></h3></div>
        <h3><a class="btn btn-default btn-xs pull-right" href="/event/{{dataset.event_tree}}">View Maps and Graphs</a></h3>

    </div>
</div>


<table cellpadding="3" cellspacing="3" class="table table-striped">
    <tr>
        <td><b>Dataset Title</b>
        </td>
        <td>{{{dataset.name}}}</td>
    </tr>
    <tr>
        <td><b>Created</b>
        </td>
        <td>{{{epochdate dataset.create_time}}}&nbsp;&nbsp;&nbsp;{{{epochtime dataset.create_time}}}</td>
    </tr>
    <tr>
        <td><b>Submit User</b>
        </td>
        <td><a href="/user/{{dataset.create_user.id}}">{{{dataset.create_user.display_name}}}</a>
        </td>
    </tr>
    <tr>
        <td><b>Start Time</b>
        </td>
        <td>{{{epochdate dataset.start_time}}}&nbsp;&nbsp;&nbsp;{{{epochtime dataset.start_time}}}</td>
    </tr>
    <tr>
        <td><b>End Time</b>
        </td>
        <td>{{{epochdate dataset.end_time}}}&nbsp;&nbsp;&nbsp;{{{epochtime dataset.end_time}}}</td>
    </tr>
    <tr>
        <td><b>Duration</b>
        </td>
        <td>{{{duration dataset.start_time dataset.end_time}}}</td>
    </tr>
    <tr>
        <td><b>Submitted Filename</b>
        </td>
        <td>{{{dataset.filename}}}</td>
    </tr>
    <tr>
        <td><b>Number of Rows</b>
        </td>
        <td>{{{dataset.number_rows}}}</td>
    </tr>
    <tr>
        <td><b>SCAD Unit</b>
        </td>
        <td>{{{dataset.scad_unit}}}</td>
    </tr>
</table>

<br />

<h2>Event Tree</h2>
<div id="insert_event_tree"> <!--Loaded by jQuery--> </div>

<br />

<h2>Aggregate Summary</h2>
<div id="aggregatestatistics"><!--Loaded by jQuery-->
    <div class="panel panel-default">
        <div class="panel-body">Sorry, aggregate not available right now.</div>
    </div>
</div>

<br /><br/>

<h2> Download</h2>
<div class="panel panel-default">
    <div class="panel-heading"><strong>Options</strong></div>
    <div class="panel-body">
        <h3>
            <a download="{{dataset.id}}-panel.csv" href="/api/dataset/{{dataset.id}}?minmax=false">Complete Panel</a>
            ~ <a href="/dataset/{{dataset.id}}/download">Custom Panel</a>
        </h3>


        <h5>Download Sensors: <a download="{{dataset.id}}-accl.csv" target="_blank" href="/api/dataset/{{dataset.id}}?columns=acceleration:x,acceleration:y,acceleration:z&minmax=false">Accelerometer</a>
            ~ <a download="{{dataset.id}}-gyro.csv" target="_blank" href="/api/dataset/{{dataset.id}}?columns=rotationrate:x,rotationrate:y,rotationrate:z&minmax=false">Gyroscope</a>
            ~ <a download="{{dataset.id}}-magn.csv" target="_blank" href="/api/dataset/{{dataset.id}}?columns=magneticfield:x,magneticfield:y,magneticfield:z&minmax=false">Magnetometer</a>
            ~ <a download="{{dataset.id}}-baro.csv" target="_blank" href="/api/dataset/{{dataset.id}}?columns=pressure:pressure&minmax=false">Barometer</a>
            ~ <a download="{{dataset.id}}-temp.csv" target="_blank" href="/api/dataset/{{dataset.id}}?columns=pressure:temperature&minmax=false">Temperature</a>
            ~ <a download="{{dataset.id}}-gps.csv" target="_blank" href="/api/dataset/{{dataset.id}}?columns=gps:latitude,gps:longitude&minmax=false">GPS</a>

        </h5>
    </div>
</div>
<br/>

<h2>Processing Notes</h2>
<div class="panel panel-default">
    <div class="panel-heading"><strong>Comments from the conversion</strong></div>
    <div class="panel-body">
<pre><code>
{{{dataset.processing_notes}}}
</code></pre>
    </div>
</div>

<br />

<h2>Processing Statistics</h2>
<div class="panel panel-default">
    <div class="panel-heading"><strong>Outputs from the conversion</strong></div>
    <div class="panel-body">
<pre><code>
{{{dataset.processing_statistics}}}
</code></pre>
    </div>
</div>

<br />

<h2>Processing Configuration</h2>
<div class="panel panel-default">
    <div class="panel-heading"><strong>Parameters to the conversion</strong></div>
    <div class="panel-body">
<pre><code>
{{{dataset.processing_config}}}
</code></pre>
    </div>
</div>
    
        
<br />

<br /> <b>Dataset UUID: </b> {{dataset.id}}
<br /> <b>Raw Data UUID: </b> {{dataset.raw_data}}
<br /> <b>Root Event UUID: </b> {{dataset.event_tree}}
<br />
